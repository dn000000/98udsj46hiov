# Алгоритм поиска равноудаленной точки

## Описание алгоритма

Алгоритм поиска равноудаленной точки предназначен для нахождения такой точки в лабиринте, которая находится на примерно одинаковом расстоянии от всех героев. Поиск такой точки может быть полезен для определения оптимального места встречи героев или для выбора промежуточной цели в игровых стратегиях.

## Формулировка задачи

Дан лабиринт с несколькими героями (от 2 до 9). Требуется найти такую точку, которая:
1. Достижима от всех героев (существует проходимый путь)
2. Расстояние от этой точки до каждого героя примерно одинаково
3. Если абсолютно равноудаленную точку найти невозможно, то ищется такая, для которой максимальное расстояние до любого из героев минимально

## Математическая модель

### Формальное описание

- Пусть $M$ - множество всех допустимых (проходимых) точек лабиринта.
- Пусть $H = \{h_1, h_2, ..., h_n\}$ - множество позиций героев, где $n \geq 2$.
- Для каждого героя $h_i$ и точки $p \in M$ определим расстояние $d(h_i, p)$ как длину кратчайшего пути от $h_i$ до $p$ в лабиринте.
- Для каждой точки $p \in M$ определим максимальное расстояние до любого героя: $D(p) = \max\limits_{h_i \in H} d(h_i, p)$.
- Наша задача - найти такую точку $p^* \in M$, что $D(p^*)$ минимально, т.е. $p^* = \arg\min\limits_{p \in M} D(p)$.

### Идеальное решение

В идеальном случае мы хотим найти такую точку $p^*$, для которой расстояния до всех героев равны, т.е. $d(h_i, p^*) = d(h_j, p^*)$ для всех $i, j \in \{1, 2, ..., n\}$.

### Мера равноудаленности

Для оценки "равноудаленности" точки используется дисперсия расстояний:
$$\sigma^2(p) = \frac{1}{n} \sum_{i=1}^{n} (d(h_i, p) - \mu(p))^2$$

где $\mu(p) = \frac{1}{n} \sum_{i=1}^{n} d(h_i, p)$ - среднее расстояние от точки $p$ до всех героев.

Чем меньше дисперсия, тем более равноудалена точка.

## Алгоритм

1. **Предварительный этап**:
   - Для каждого героя вычисляем расстояния до всех достижимых точек лабиринта, используя алгоритм BFS.
   - Рассматриваем только те точки, которые достижимы от всех героев.

2. **Поиск равноудаленной точки**:
   - Для каждой достижимой точки $p$:
     - Вычисляем максимальное расстояние $D(p)$ от этой точки до любого из героев.
   - Выбираем точку с минимальным значением $D(p)$.
   - Если существует несколько точек с одинаковым минимальным значением $D(p)$, выбираем ту, для которой минимальное расстояние $\min\limits_{h_i \in H} d(h_i, p)$ максимально (т.е. предпочитаем точки, где расстояния более равномерны).

3. **Построение путей**:
   - Для найденной равноудаленной точки строим пути от всех героев, используя сохраненные данные о предыдущих вершинах в алгоритме BFS.

## Оптимизации

1. **Ранний останов**: Если мы нашли точку, для которой все расстояния до героев равны, и при этом эти расстояния не превышают некоторого порога, мы можем прекратить поиск, так как нашли идеальное решение.

2. **Пропуск недостижимых точек**: Точки, недостижимые хотя бы от одного героя, сразу исключаются из рассмотрения.

3. **Кэширование расстояний**: Результаты вычисления расстояний для каждого героя сохраняются и переиспользуются.

## Сложность алгоритма

- **Временная сложность**: O(n * |M|), где n - количество героев, |M| - количество достижимых точек в лабиринте. Это следует из того, что для каждого героя мы запускаем алгоритм BFS (O(|M|)), и затем проверяем O(|M|) точек.

- **Пространственная сложность**: O(n * |M|) для хранения расстояний от каждого героя до всех точек.

## Визуализация

Для наглядного представления результатов работы алгоритма реализованы следующие визуализации:

1. **Отображение лабиринта с героями и равноудаленной точкой**: На визуализации показаны все герои, равноудаленная точка и пути от героев до этой точки.

2. **Тепловые карты расстояний**: Для каждого героя создается тепловая карта, показывающая расстояния от этого героя до всех достижимых точек лабиринта. Это помогает понять, как формируется область равноудаленных точек. 